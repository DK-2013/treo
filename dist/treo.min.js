(function(e){if(typeof exports==="object"&&typeof module!=="undefined"){module.exports=e()}else if(typeof define==="function"&&define.amd){define([],e)}else{var t;if(typeof window!=="undefined"){t=window}else if(typeof global!=="undefined"){t=global}else if(typeof self!=="undefined"){t=self}else{t=this}t.treo=e()}})(function(){var e,t,r;return function n(e,t,r){function i(u,a){if(!t[u]){if(!e[u]){var s=typeof require=="function"&&require;if(!a&&s)return s(u,!0);if(o)return o(u,!0);var f=new Error("Cannot find module '"+u+"'");throw f.code="MODULE_NOT_FOUND",f}var l=t[u]={exports:{}};e[u][0].call(l.exports,function(t){var r=e[u][1][t];return i(r?r:t)},l,l.exports,n,e,t,r)}return t[u].exports}var o=typeof require=="function"&&require;for(var u=0;u<r.length;u++)i(r[u]);return i}({1:[function(e,t,r){t.exports=n;function n(e){if(e)return i(e)}function i(e){for(var t in n.prototype){e[t]=n.prototype[t]}return e}n.prototype.on=n.prototype.addEventListener=function(e,t){this._callbacks=this._callbacks||{};(this._callbacks["$"+e]=this._callbacks["$"+e]||[]).push(t);return this};n.prototype.once=function(e,t){function r(){this.off(e,r);t.apply(this,arguments)}r.fn=t;this.on(e,r);return this};n.prototype.off=n.prototype.removeListener=n.prototype.removeAllListeners=n.prototype.removeEventListener=function(e,t){this._callbacks=this._callbacks||{};if(0==arguments.length){this._callbacks={};return this}var r=this._callbacks["$"+e];if(!r)return this;if(1==arguments.length){delete this._callbacks["$"+e];return this}var n;for(var i=0;i<r.length;i++){n=r[i];if(n===t||n.fn===t){r.splice(i,1);break}}return this};n.prototype.emit=function(e){this._callbacks=this._callbacks||{};var t=[].slice.call(arguments,1),r=this._callbacks["$"+e];if(r){r=r.slice(0);for(var n=0,i=r.length;n<i;++n){r[n].apply(this,t)}}return this};n.prototype.listeners=function(e){this._callbacks=this._callbacks||{};return this._callbacks["$"+e]||[]};n.prototype.hasListeners=function(e){return!!this.listeners(e).length}},{}],2:[function(e,t,r){(function(n){"use strict";var i=function(){function e(e,t){var r=[];var n=true;var i=false;var o=undefined;try{for(var u=e[Symbol.iterator](),a;!(n=(a=u.next()).done);n=true){r.push(a.value);if(t&&r.length===t)break}}catch(s){i=true;o=s}finally{try{if(!n&&u["return"])u["return"]()}finally{if(i)throw o}}return r}return function(t,r){if(Array.isArray(t)){return t}else if(Symbol.iterator in Object(t)){return e(t,r)}else{throw new TypeError("Invalid attempt to destructure non-iterable instance")}}}();Object.defineProperty(r,"__esModule",{value:true});r.default=d;var o=e("is-plain-obj");var u=f(o);var a=e("is-safari");var s=f(a);function f(e){return e&&e.__esModule?e:{"default":e}}var l=[].slice;var c=[].map;function d(e,t,r){if(arguments.length!==3)throw new TypeError("invalid arguments length");if(typeof t!=="string")throw new TypeError('invalid "storeName"');if(!Array.isArray(r)&&!(0,u.default)(r))throw new TypeError('invalid "ops"');if((0,u.default)(r)){r=Object.keys(r).map(function(e){return{key:e,value:r[e],type:r[e]===null?"del":"put"}})}r.forEach(function(e){if(!(0,u.default)(e))throw new TypeError("invalid op");if(["add","put","del"].indexOf(e.type)===-1)throw new TypeError('invalid type "'+e.type+'"')});return new Promise(function(n,i){var o=e.transaction(t,"readwrite");var u=o.objectStore(t);var a=[];var s=0;o.onerror=y(i);o.oncomplete=function(){return n(a)};f();function f(){var e=r[s];var t=e.type;var n=e.key;if(t==="del")return l(u.delete(n));var o=r[s].val||r[s].value;if(n&&u.keyPath)o[u.keyPath]=n;v(u,n,o,function(e,r){if(e)return i(e);if(r)return i(new Error("Unique index ConstraintError"));l(u.keyPath?u[t](o):u[t](o,n))})}function l(e){s+=1;e.onerror=y(i);e.onsuccess=function(e){a.push(e.target.result);if(s<r.length)f()}}})}function v(e,t,r,o){if(!s.default&&n.indexedDB!==n.shimIndexedDB)return o();var u=l.call(e.indexNames).map(function(t){var n=e.index(t);var i=p(n)?c.call(n.keyPath,function(e){return r[e]}).filter(function(e){return Boolean(e)}):r[n.keyPath];return[n,i]}).filter(function(e){var t=i(e,2);var r=t[0];var n=t[1];return r.unique&&(p(r)?n.length:n)});if(!u.length)return o();var a=u.length;var f=0;u.forEach(function(e){var r=i(e,2);var n=r[0];var u=r[1];var s=n.getKey(u);s.onerror=y(o);s.onsuccess=function(e){if(e.target.result&&e.target.result!==t)f+=1;a-=1;if(a===0)o(null,f)}})}function p(e){return typeof e.keyPath!=="string"}function y(e){return function(t){if(typeof t.preventDefault==="function")t.preventDefault();e(t.target.error)}}t.exports=r["default"]}).call(this,typeof global!=="undefined"?global:typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{"is-plain-obj":6,"is-safari":7}],3:[function(e,t,r){(function(e){"use strict";Object.defineProperty(r,"__esModule",{value:true});r.open=t;r.del=n;r.cmp=i;function t(e,t,r){return new Promise(function(n,i){var u=true;var a=function s(){var a=t?o().open(e,t):o().open(e);a.onblocked=function(){if(u){u=false;setTimeout(s,100)}else{i(new Error("database is blocked"))}};if(typeof r==="function")a.onupgradeneeded=r;a.onerror=function(e){return i(e.target.error)};a.onsuccess=function(e){return n(e.target.result)}};a()})}function n(e){var t=typeof e!=="string"?e.name:e;return new Promise(function(r,n){var i=true;var u=function a(){var e=o().deleteDatabase(t);e.onblocked=function(){if(i){i=false;setTimeout(a,100)}else{n(new Error("database is blocked"))}};e.onerror=function(e){return n(e.target.error)};e.onsuccess=function(){return r()}};if(typeof e!=="string"){e.close();setTimeout(u,100)}else{u()}})}function i(e,t){return o().cmp(e,t)}function o(){return e.forceIndexedDB||e.indexedDB||e.webkitIndexedDB||e.mozIndexedDB||e.msIndexedDB||e.shimIndexedDB}}).call(this,typeof global!=="undefined"?global:typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{}],4:[function(e,t,r){(function(n){"use strict";Object.defineProperty(r,"__esModule",{value:true});r.default=a;var i=e("is-plain-obj");var o=u(i);function u(e){return e&&e.__esModule?e:{"default":e}}function a(e){var t=n.IDBKeyRange||n.webkitIDBKeyRange;if(e instanceof t)return e;if(typeof e==="undefined"||e===null)return null;if(!(0,o.default)(e))return t.only(e);var r=Object.keys(e).sort();if(r.length===1){var i=r[0];var u=e[i];switch(i){case"eq":return t.only(u);case"gt":return t.lowerBound(u,true);case"lt":return t.upperBound(u,true);case"gte":return t.lowerBound(u);case"lte":return t.upperBound(u);default:throw new TypeError('"'+i+'" is not valid key')}}else{var a=e[r[0]];var s=e[r[1]];var f=r.join("-");switch(f){case"gt-lt":return t.bound(a,s,true,true);case"gt-lte":return t.bound(a,s,true,false);case"gte-lt":return t.bound(a,s,false,true);case"gte-lte":return t.bound(a,s,false,false);default:throw new TypeError('"'+f+'" are conflicted keys')}}}t.exports=r["default"]}).call(this,typeof global!=="undefined"?global:typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{"is-plain-obj":6}],5:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:true});r.request=n;r.requestTransaction=i;r.requestCursor=o;r.mapCursor=u;function n(e){var t=arguments.length<=1||arguments[1]===undefined?null:arguments[1];var r=undefined;return new Promise(function(n,i){e.onerror=a(i);e.onsuccess=function(e){r=e.target.result;if(!t)n(e.target.result)};if(t)t.oncomplete=function(){return n(r)}})}function i(e){return new Promise(function(t,r){e.onerror=a(r);e.oncomplete=function(){return t()}})}function o(e,t){var r={};var n=function i(e){if((e.direction==="prevunique"||e.direction==="nextunique")&&!e.source.multiEntry){if(!r[e.key]){r[e.key]=true;t(e)}else{e.continue()}}else{t(e)}};return new Promise(function(t,r){e.onerror=a(r);e.onsuccess=function(e){var r=e.target.result;if(r){n(r)}else{t()}}})}function u(e,t){var r=[];return o(e,function(e){return t(e,r)}).then(function(){return r})}function a(e){return function(t){if(typeof t.preventDefault==="function")t.preventDefault();e(t.target.error)}}},{}],6:[function(e,t,r){"use strict";var n=Object.prototype.toString;t.exports=function(e){var t;return n.call(e)==="[object Object]"&&(t=Object.getPrototypeOf(e),t===null||t===Object.getPrototypeOf({}))}},{}],7:[function(e,t,r){"use strict";t.exports=typeof navigator!=="undefined"&&/Version\/[\d\.]+.*Safari/.test(navigator.userAgent)},{}],8:[function(e,t,r){"use strict";var n=Object.prototype.hasOwnProperty;var i=Object.prototype.propertyIsEnumerable;function o(e){if(e===null||e===undefined){throw new TypeError("Object.assign cannot be called with null or undefined")}return Object(e)}t.exports=Object.assign||function(e,t){var r;var u=o(e);var a;for(var s=1;s<arguments.length;s++){r=Object(arguments[s]);for(var f in r){if(n.call(r,f)){u[f]=r[f]}}if(Object.getOwnPropertySymbols){a=Object.getOwnPropertySymbols(r);for(var l=0;l<a.length;l++){if(i.call(r,a[l])){u[a[l]]=r[a[l]]}}}}return u}},{}],9:[function(e,t,r){(function(r){var n=e("component-emitter");var i=n.prototype.emit;var o="!!storage-emitter-key";var u=new n;r.addEventListener("storage",function a(e){if(e.key!=o)return;if(!e.newValue)return;try{var t=JSON.parse(e.newValue);u.listeners(t.event).forEach(function(e){e.call(u,t.args)})}catch(r){console.error("unexpected value: "+r.newValue)}},false);u.emit=function(e,t){var r=JSON.stringify({event:e,args:t});localStorage.setItem(o,r);localStorage.removeItem(o);return i.apply(this,arguments)};t.exports=u}).call(this,typeof global!=="undefined"?global:typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{"component-emitter":1}],10:[function(e,t,r){"use strict";var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||false;n.configurable=true;if("value"in n)n.writable=true;Object.defineProperty(e,n.key,n)}}return function(t,r,n){if(r)e(t.prototype,r);if(n)e(t,n);return t}}();Object.defineProperty(r,"__esModule",{value:true});var i=e("component-emitter");var o=c(i);var u=e("idb-factory");var a=e("storage-emitter");var s=c(a);var f=e("./idb-store");var l=c(f);function c(e){return e&&e.__esModule?e:{"default":e}}function d(e,t){if(!(e instanceof t)){throw new TypeError("Cannot call a class as a function")}}function v(e,t){if(!e){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return t&&(typeof t==="object"||typeof t==="function")?t:e}function p(e,t){if(typeof t!=="function"&&t!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof t)}e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:false,writable:true,configurable:true}});if(t)Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t}var y=function(e){p(t,e);function t(e){d(this,t);var r=v(this,Object.getPrototypeOf(t).call(this));r.db=e;r.db.onerror=function(e){r.emit("error",e.target.error)};r.db.onversionchange=function(){r.close();r.emit("versionchange")};s.default.once("versionchange",function(e){var t=e.name;var n=e.version;var i=e.isDelete;if(t===r.name&&(n>r.version||i)){r.close();r.emit("versionchange")}});r.stores.forEach(function(e){if(typeof r[e]!=="undefined")return;Object.defineProperty(r,e,{get:function t(){return this.store(e)}})});return r}n(t,[{key:"store",value:function r(e){if(this.stores.indexOf(e)===-1)throw new TypeError('"'+e+'" store does not exist');return new l.default(this.db,e)}},{key:"del",value:function i(){s.default.emit("versionchange",{name:this.name,isDelete:true});return(0,u.del)(this.db)}},{key:"close",value:function o(){this.db.close();this.emit("close")}},{key:"name",get:function a(){return this.db.name}},{key:"version",get:function f(){return this.db.version}},{key:"stores",get:function c(){return[].slice.call(this.db.objectStoreNames)}}]);return t}(o.default);r.default=y;t.exports=r["default"]},{"./idb-store":13,"component-emitter":1,"idb-factory":3,"storage-emitter":9}],11:[function(e,t,r){(function(e){"use strict";Object.defineProperty(r,"__esModule",{value:true});r.storeDescriptor=i;r.indexDescriptor=o;var t=[].slice;var n={};function i(e,r){if(!n[e.name])n[e.name]={};if(!n[e.name][e.version])n[e.name][e.version]={};if(!n[e.name][e.version][r]){(function(){var i=e.transaction(r,"readonly").objectStore(r);var o={};t.call(i.indexNames).forEach(function(e){var t=i.index(e);o[e]={name:e,keyPath:c(t.keyPath),unique:t.unique,multiEntry:t.multiEntry||false}});n[e.name][e.version][r]={name:r,keyPath:i.keyPath,autoIncrement:i.autoIncrement,indexes:o}})()}return u(n[e.name][e.version][r])}function o(e,t,r){return i(e,t).indexes[r]}function u(e){return JSON.parse(JSON.stringify(e))}var a="__$$compoundKey";var s="$_$";var f=/\$\$/g;function l(e){e=e.substr(a.length+1);e=e.split(s);for(var t=0;t<e.length;t++){e[t]=e[t].replace(f,".")}return e}function c(t){if(t instanceof e.DOMStringList){return[].slice.call(t)}else if(t.indexOf(a)!==-1){return l(t)}return t}}).call(this,typeof global!=="undefined"?global:typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{}],12:[function(e,t,r){"use strict";var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||false;n.configurable=true;if("value"in n)n.writable=true;Object.defineProperty(e,n.key,n)}}return function(t,r,n){if(r)e(t.prototype,r);if(n)e(t,n);return t}}();Object.defineProperty(r,"__esModule",{value:true});var i=e("idb-range");var o=f(i);var u=e("idb-request");var a=e("./idb-take");var s=e("./idb-descriptor");function f(e){return e&&e.__esModule?e:{"default":e}}function l(e,t){if(!(e instanceof t)){throw new TypeError("Cannot call a class as a function")}}var c=true;var d=function(){function e(t,r,n){l(this,e);if(typeof r!=="string")throw new TypeError('"storeName" is required');if(typeof n!=="string")throw new TypeError('"indexName" is required');this.db=t;this.storeName=r;this.props=(0,s.indexDescriptor)(t,r,n);if(this.multi&&c){c=false;console.warn("multiEntry index is not supported completely, because it does not work in IE. But it should work in remaining browsers.")}}n(e,[{key:"get",value:function t(e){var t=this.db.transaction(this.storeName,"readonly").objectStore(this.storeName).index(this.name);return(0,u.request)(t.get(e)).then(function(e){return e!==null?e:undefined})}},{key:"getAll",value:function r(e,t){return(0,a.take)(this,e,t)}},{key:"count",value:function i(e){try{var t=this.db.transaction(this.storeName,"readonly").objectStore(this.storeName).index(this.name);return(0,u.request)(t.count((0,o.default)(e)))}catch(r){return this.getAll(e).then(function(e){return e.length})}}},{key:"openCursor",value:function f(e){var t=arguments.length<=1||arguments[1]===undefined?"next":arguments[1];var r=this.db.transaction(this.storeName,"readonly").objectStore(this.storeName).index(this.name);return r.openCursor((0,o.default)(e),t)}},{key:"name",get:function d(){return this.props.name}},{key:"key",get:function v(){return this.props.keyPath}},{key:"unique",get:function p(){return this.props.unique}}]);return e}();r.default=d;t.exports=r["default"]},{"./idb-descriptor":11,"./idb-take":14,"idb-range":4,"idb-request":5}],13:[function(e,t,r){"use strict";var n=function(){function e(e,t){var r=[];var n=true;var i=false;var o=undefined;try{for(var u=e[Symbol.iterator](),a;!(n=(a=u.next()).done);n=true){r.push(a.value);if(t&&r.length===t)break}}catch(s){i=true;o=s}finally{try{if(!n&&u["return"])u["return"]()}finally{if(i)throw o}}return r}return function(t,r){if(Array.isArray(t)){return t}else if(Symbol.iterator in Object(t)){return e(t,r)}else{throw new TypeError("Invalid attempt to destructure non-iterable instance")}}}();var i=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||false;n.configurable=true;if("value"in n)n.writable=true;Object.defineProperty(e,n.key,n)}}return function(t,r,n){if(r)e(t.prototype,r);if(n)e(t,n);return t}}();Object.defineProperty(r,"__esModule",{value:true});var o=e("idb-range");var u=p(o);var a=e("idb-request");var s=e("idb-batch");var f=p(s);var l=e("./idb-descriptor");var c=e("./idb-take");var d=e("./idb-index");var v=p(d);function p(e){return e&&e.__esModule?e:{"default":e}}function y(e,t){if(!(e instanceof t)){throw new TypeError("Cannot call a class as a function")}}var h=function(){function e(t,r){var n=this;y(this,e);if(typeof r!=="string")throw new TypeError('"storeName" is required');this.db=t;this.props=(0,l.storeDescriptor)(t,r);this.indexes.forEach(function(e){if(typeof n[e]!=="undefined")return;Object.defineProperty(n,e,{get:function t(){return this.index(e)}})})}i(e,[{key:"index",value:function t(e){if(this.indexes.indexOf(e)===-1)throw new TypeError('"'+e+'" index does not exist');return new v.default(this.db,this.name,e)}},{key:"add",value:function r(e,t){if(typeof t==="undefined"){t=e;e=undefined}return(0,f.default)(this.db,this.name,[{key:e,val:t,type:"add"}]).then(function(e){var t=n(e,1);var r=t[0];return r})}},{key:"put",value:function o(e,t){if(typeof t==="undefined"){t=e;e=undefined}return(0,f.default)(this.db,this.name,[{key:e,val:t,type:"put"}]).then(function(e){var t=n(e,1);var r=t[0];return r})}},{key:"del",value:function s(e){return(0,f.default)(this.db,this.name,[{key:e,type:"del"}]).then(function(e){var t=n(e,1);var r=t[0];return r})}},{key:"batch",value:function d(e){return(0,f.default)(this.db,this.name,e)}},{key:"clear",value:function p(){var e=this.db.transaction(this.name,"readwrite");return(0,a.request)(e.objectStore(this.name).clear(),e)}},{key:"get",value:function h(e){var t=this.db.transaction(this.name,"readonly").objectStore(this.name);return(0,a.request)(t.get(e))}},{key:"getAll",value:function b(e,t){return(0,c.take)(this,e,t)}},{key:"count",value:function g(e){try{var t=this.db.transaction(this.name,"readonly").objectStore(this.name);return(0,a.request)(t.count(e))}catch(r){return this.getAll(e).then(function(e){return e.length})}}},{key:"openCursor",value:function m(e){var t=arguments.length<=1||arguments[1]===undefined?"next":arguments[1];var r=this.db.transaction(this.name,"readonly").objectStore(this.name);return r.openCursor((0,u.default)(e),t)}},{key:"name",get:function w(){return this.props.name}},{key:"key",get:function k(){return this.props.keyPath}},{key:"indexes",get:function x(){return Object.keys(this.props.indexes)}}]);return e}();r.default=h;t.exports=r["default"]},{"./idb-descriptor":11,"./idb-index":12,"./idb-take":14,"idb-batch":2,"idb-range":4,"idb-request":5}],14:[function(e,t,r){"use strict";var n=function(){function e(e,t){var r=[];var n=true;var i=false;var o=undefined;try{for(var u=e[Symbol.iterator](),a;!(n=(a=u.next()).done);n=true){r.push(a.value);if(t&&r.length===t)break}}catch(s){i=true;o=s}finally{try{if(!n&&u["return"])u["return"]()}finally{if(i)throw o}}return r}return function(t,r){if(Array.isArray(t)){return t}else if(Symbol.iterator in Object(t)){return e(t,r)}else{throw new TypeError("Invalid attempt to destructure non-iterable instance")}}}();Object.defineProperty(r,"__esModule",{value:true});r.take=c;r.takeRight=d;r.takeOne=v;r.takeRightOne=p;var i=e("object-assign");var o=f(i);var u=e("idb-range");var a=f(u);var s=e("idb-request");function f(e){return e&&e.__esModule?e:{"default":e}}var l={limit:Infinity,offset:0,unique:false,reverse:false};function c(e){var t=arguments.length<=1||arguments[1]===undefined?null:arguments[1];var r=arguments.length<=2||arguments[2]===undefined?{}:arguments[2];var n=(0,o.default)({},l,r);var i=n.offset;var u=n.limit;var f=n.unique;var c=n.reverse;var d=(c?"prev":"next")+(f?"unique":"");var v=e.openCursor((0,a.default)(t),d);var p=i;return(0,s.mapCursor)(v,function(e,t){if(p===0){if(u>t.length)t.push(e.value);e.continue()}else{p-=1;e.continue()}})}function d(e,t){var r=arguments.length<=2||arguments[2]===undefined?{}:arguments[2];r.reverse=true;return c(e,t,r)}function v(e,t){var r=arguments.length<=2||arguments[2]===undefined?{}:arguments[2];return c(e,t,r).then(function(e){var t=n(e,1);var r=t[0];return r})}function p(e,t){var r=arguments.length<=2||arguments[2]===undefined?{}:arguments[2];return d(e,t,r).then(function(e){var t=n(e,1);var r=t[0];return r})}},{"idb-range":4,"idb-request":5,"object-assign":8}],15:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:true});r.Index=r.Store=r.Database=undefined;r.default=v;var n=e("storage-emitter");var i=d(n);var o=e("idb-factory");var u=e("./idb-database");var a=d(u);var s=e("./idb-store");var f=d(s);var l=e("./idb-index");var c=d(l);function d(e){return e&&e.__esModule?e:{"default":e}}function v(e,t,r){if(typeof e!=="string")throw new TypeError('"name" is required');if(typeof t!=="undefined")i.default.emit("versionchange",{name:e,version:t});return(0,o.open)(e,t,r).then(function(e){return new a.default(e)})}r.Database=a.default;r.Store=f.default;r.Index=c.default},{"./idb-database":10,"./idb-index":12,"./idb-store":13,"idb-factory":3,"storage-emitter":9}]},{},[15])(15)});
