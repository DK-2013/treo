(function(e){if(typeof exports==="object"&&typeof module!=="undefined"){module.exports=e()}else if(typeof define==="function"&&define.amd){define([],e)}else{var t;if(typeof window!=="undefined"){t=window}else if(typeof global!=="undefined"){t=global}else if(typeof self!=="undefined"){t=self}else{t=this}t.treo=e()}})(function(){var e,t,r;return function n(e,t,r){function o(s,u){if(!t[s]){if(!e[s]){var a=typeof require=="function"&&require;if(!u&&a)return a(s,!0);if(i)return i(s,!0);var c=new Error("Cannot find module '"+s+"'");throw c.code="MODULE_NOT_FOUND",c}var f=t[s]={exports:{}};e[s][0].call(f.exports,function(t){var r=e[s][1][t];return o(r?r:t)},f,f.exports,n,e,t,r)}return t[s].exports}var i=typeof require=="function"&&require;for(var s=0;s<r.length;s++)o(r[s]);return o}({1:[function(e,t,r){(function(r){var n=e("component-emitter");var o=e("component-type");var i=e("idb-schema");var s=e("idb-request");var u=e("./idb-transaction");var a=e("./idb-store");t.exports=c;function c(e,t){if(!(this instanceof c))return new c(e,t);if(o(e)!="string")throw new TypeError("`name` required");if(!(t instanceof i))throw new TypeError("not valid schema");this.status="close";this.origin=null;this.schema=t;this.opts=t.stores();this.name=e;this.version=t.version();this.stores=this.opts.map(function(e){return e.name})}n(c.prototype);c.prototype.use=function(t){t(this,e("./index"));return this};c.prototype.del=function(){var e=r.indexedDB||r.webkitIndexedDB;var t=this;return this.close().then(function(){return new s.Promise(function(e){setTimeout(e,50)}).then(function(){return s(e.deleteDatabase(t.name))})})};c.prototype.close=function(){if(this.status=="close")return s.Promise.resolve();var e=this;return this.getInstance().then(function(t){t.close();e.removeAllListeners();e.origin=null;e.status="close"})};c.prototype.store=function(e,t){var r=this.stores.indexOf(e);if(r==-1)throw new TypeError("invalid store name");return new a(this,t,this.opts[r])};c.prototype.transaction=function(e,t){if(!t)t="readonly";else if(t=="read")t="readonly";else if(t=="write")t="readwrite";return new u(this,e,t)};c.prototype.getInstance=function(){if(this.status=="open")return s.Promise.resolve(this.origin);if(this.status=="error")return new Error("database error");if(this.status=="opening")return this.promise;var e=this;this.status="opening";this.promise=new s.Promise(function(t,n){var o=r.indexedDB||r.webkitIndexedDB;var i=o.open(e.name,e.version);i.onupgradeneeded=e.schema.callback();i.onerror=i.onblocked=function(t){delete e.promise;e.status="error";n(t)};i.onsuccess=function(r){var n=r.target.result;delete e.promise;e.status="open";e.origin=n;n.onerror=function(t){e.emit("error",t)};n.onabort=function(){e.emit("abort")};n.onclose=function(){e.emit("close")};n.onversionchange=function(t){e.emit("versionchange",t);e.close().catch(function(t){e.emit("error",t)})};t(n)}});return this.promise}}).call(this,typeof global!=="undefined"?global:typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{"./idb-store":3,"./idb-transaction":4,"./index":5,"component-emitter":6,"component-type":7,"idb-request":9,"idb-schema":10}],2:[function(e,t,r){var n=e("idb-range");var o=e("idb-request");var i=e("component-type");t.exports=s;function s(e,t){this.store=e;this.name=t.name;this.field=t.field;this.multi=t.multiEntry;this.unique=t.unique}s.prototype.get=function(e){var t=this;return this.store._tr("read").then(function(r){var n=r.objectStore(t.store.name).index(t.name);return o(n.get(e))})};s.prototype.getAll=function(e){var t=[];return this.cursor({range:e,iterator:r}).then(function(){return t});function r(e){t.push(e.value);e.continue()}};s.prototype.count=function(e){var t=this;return this.store._tr("read").then(function(r){var i=r.objectStore(t.store.name).index(t.name);return o(i.count(n(e)))})};s.prototype.cursor=function(e){if(i(e.iterator)!="function")throw new TypeError("opts.iterator required");var t=this;return this.store._tr("read").then(function(r){var i=r.objectStore(t.store.name).index(t.name);var s=i.openCursor(n(e.range),e.direction||"next");return o(s,e.iterator)})}},{"component-type":7,"idb-range":8,"idb-request":9}],3:[function(e,t,r){var n=e("component-type");var o=e("idb-range");var i=e("idb-request");var s=e("./idb-index");t.exports=u;function u(e,t,r){this.db=e;this.tr=t;this.opts=r.indexes;this.name=r.name;this.key=r.keyPath;this.increment=r.autoIncrement;this.indexes=r.indexes.map(function(e){return e.name})}u.prototype.index=function(e){var t=this.indexes.indexOf(e);if(t==-1)throw new TypeError("invalid index name");return new s(this,this.opts[t])};u.prototype.put=function(e,t){var r=this;if(this.key&&n(t)!="undefined"){t[this.key]=e}else if(this.key){t=e}return this._tr("write").then(function(n){var o=n.objectStore(r.name);return i(r.key?o.put(t):o.put(t,e),n)})};u.prototype.add=function(e,t){var r=this;if(this.key&&n(t)!="undefined"){t[this.key]=e}else if(this.key){t=e}return this._tr("write").then(function(n){var o=n.objectStore(r.name);return i(r.key?o.add(t):o.add(t,e),n)})};u.prototype.get=function(e){var t=this;return this._tr("read").then(function(r){return i(r.objectStore(t.name).get(e))})};u.prototype.del=function(e){var t=this;return this._tr("write").then(function(r){return i(r.objectStore(t.name).delete(e))})};u.prototype.count=function(e){var t=this;return this._tr("read").then(function(r){return i(r.objectStore(t.name).count(o(e)))})};u.prototype.clear=function(){var e=this;return this._tr("write").then(function(t){return i(t.objectStore(e.name).clear())})};u.prototype.batch=function(e){var t=this;var r=Object.keys(e);return this._tr("write").then(function(n){return new i.Promise(function(o,i){var s=n.objectStore(t.name);var u=0;n.onerror=n.onabort=i;n.oncomplete=function(){o()};a();function a(){if(u>=r.length)return;var n=r[u];var o=e[n];var c;if(o===null){c=s.delete(n)}else if(t.key){if(!o[t.key])o[t.key]=n;c=s.put(o)}else{c=s.put(o,n)}c.onerror=i;c.onsuccess=a;u+=1}})})};u.prototype.getAll=function(e){var t=[];return this.cursor({iterator:r,range:e}).then(function(){return t});function r(e){t.push(e.value);e.continue()}};u.prototype.cursor=function(e){if(n(e.iterator)!="function")throw new TypeError("iterator required");var t=this;return this._tr("read").then(function(r){var n=r.objectStore(t.name);var s=n.openCursor(o(e.range),e.direction||"next");return i(s,e.iterator)})};u.prototype._tr=function(e){return(this.tr||this.db.transaction([this.name],e)).getInstance()}},{"./idb-index":2,"component-type":7,"idb-range":8,"idb-request":9}],4:[function(e,t,r){var n=e("component-emitter");var o=e("idb-request");t.exports=i;function i(e,t,r){var n=this;this.db=e;this.origin=null;this.status="close";this.scope=t;this.mode=r;this.promise=new o.Promise(function(e,t){n.on("complete",e);n.on("error",t);n.on("abort",t)})}n(i.prototype);i.prototype.store=function(e){if(this.scope.indexOf(e)==-1)throw new TypeError("name out of scope");return this.db.store(e,this)};i.prototype.abort=function(){var e=this;return this.getInstance().then(function(t){e.removeAllListeners();t.abort()})};i.prototype.then=function(e,t){return this.promise.then(e,t)};i.prototype.catch=function(e){return this.promise.then(null,e)};i.prototype.getInstance=function(){if(this.status=="ready")return o.Promise.resolve(this.origin);if(this.status=="initializing")return this.dbPromise;if(this.status=="error")throw new Error("transaction error");var e=this;this.status="initializing";this.dbPromise=new o.Promise(function(t,r){e.db.getInstance().then(function(r){var n=r.transaction(e.scope,e.mode);n.onerror=function(t){e.onerror(t)};n.onabort=function(){e.emit("abort")};n.oncomplete=function(){e.emit("complete")};e.origin=n;e.status="ready";delete e.dbPromise;t(n)}).catch(function(t){e.status="error";delete e.dbPromise;r(t)})});return this.dbPromise};i.prototype.onerror=function(e){this.emit("error",e)}},{"component-emitter":6,"idb-request":9}],5:[function(e,t,r){(function(n){var o=e("idb-request");var i=e("idb-range");var s=e("idb-schema");var u=e("./idb-database");var a=e("./idb-transaction");var c=e("./idb-store");var f=e("./idb-index");r=t.exports=u;r.schema=s;r.Database=u;r.Transaction=a;r.Store=c;r.Index=f;r.request=o;r.range=i;Object.defineProperty(r,"Promise",{get:function(){return o.Promise},set:function(e){o.Promise=e}});Object.defineProperty(r,"supported",{get:function(){return!!(n.indexedDB||n.webkitIndexedDB)}})}).call(this,typeof global!=="undefined"?global:typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{"./idb-database":1,"./idb-index":2,"./idb-store":3,"./idb-transaction":4,"idb-range":8,"idb-request":9,"idb-schema":10}],6:[function(e,t,r){t.exports=n;function n(e){if(e)return o(e)}function o(e){for(var t in n.prototype){e[t]=n.prototype[t]}return e}n.prototype.on=n.prototype.addEventListener=function(e,t){this._callbacks=this._callbacks||{};(this._callbacks["$"+e]=this._callbacks["$"+e]||[]).push(t);return this};n.prototype.once=function(e,t){function r(){this.off(e,r);t.apply(this,arguments)}r.fn=t;this.on(e,r);return this};n.prototype.off=n.prototype.removeListener=n.prototype.removeAllListeners=n.prototype.removeEventListener=function(e,t){this._callbacks=this._callbacks||{};if(0==arguments.length){this._callbacks={};return this}var r=this._callbacks["$"+e];if(!r)return this;if(1==arguments.length){delete this._callbacks["$"+e];return this}var n;for(var o=0;o<r.length;o++){n=r[o];if(n===t||n.fn===t){r.splice(o,1);break}}return this};n.prototype.emit=function(e){this._callbacks=this._callbacks||{};var t=[].slice.call(arguments,1),r=this._callbacks["$"+e];if(r){r=r.slice(0);for(var n=0,o=r.length;n<o;++n){r[n].apply(this,t)}}return this};n.prototype.listeners=function(e){this._callbacks=this._callbacks||{};return this._callbacks["$"+e]||[]};n.prototype.hasListeners=function(e){return!!this.listeners(e).length}},{}],7:[function(e,t,r){var n=Object.prototype.toString;t.exports=function(e){switch(n.call(e)){case"[object Date]":return"date";case"[object RegExp]":return"regexp";case"[object Arguments]":return"arguments";case"[object Array]":return"array";case"[object Error]":return"error"}if(e===null)return"null";if(e===undefined)return"undefined";if(e!==e)return"nan";if(e&&e.nodeType===1)return"element";e=e.valueOf?e.valueOf():Object.prototype.valueOf.apply(e);return typeof e}},{}],8:[function(e,t,r){(function(e){t.exports=function n(t){var n=e.IDBKeyRange||e.webkitIDBKeyRange;if(typeof t==="undefined")return e.shimIndexedDB?undefined:null;if(t instanceof n)return t;if(!r(t))return n.only(t);var o=Object.keys(t).sort();if(o.length==1){var i=o[0];var s=t[i];switch(o[0]){case"eq":return n.only(s);case"gt":return n.lowerBound(s,true);case"lt":return n.upperBound(s,true);case"gte":return n.lowerBound(s);case"lte":return n.upperBound(s);default:throw new TypeError("`"+i+"` is not valid key")}}else{var u=t[o[0]];var a=t[o[1]];var c=o.join("-");switch(c){case"gt-lt":return n.bound(u,a,true,true);case"gt-lte":return n.bound(u,a,true,false);case"gte-lt":return n.bound(u,a,false,true);case"gte-lte":return n.bound(u,a,false,false);default:throw new TypeError("`"+c+"` are conflicted keys")}}};function r(e){return Object.prototype.toString.call(e)=="[object Object]"}}).call(this,typeof global!=="undefined"?global:typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{}],9:[function(e,t,r){(function(e){r=t.exports=n;r.Promise=e.Promise;function n(e,t){return new r.Promise(function(r,n){e.onerror=function i(e){if(e.preventDefault)e.preventDefault();n(e.target.error)};if(e.onblocked===null){e.onblocked=function s(e){if(e.preventDefault)e.preventDefault();n(e.target.error)}}if(e.onsuccess===null){if(t&&t.oncomplete===null){var o;e.onsuccess=function u(e){o=e.target.result};t.oncomplete=function a(){r(o)}}else{e.onsuccess=function c(e){var n=e.target.result;if(n&&typeof t=="function"){t(n)}else{r(n)}}}}else{e.oncomplete=function f(){r()}}})}}).call(this,typeof global!=="undefined"?global:typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{}],10:[function(e,t,r){var n=e("component-type");var o=e("component-clone");var i=e("object-values");var s=Math.pow(2,32)-1;t.exports=u;function u(){if(!(this instanceof u))return new u;this._stores={};this._current={};this._versions={};this.version(1)}u.prototype.version=function(e){if(!arguments.length)return this._current.version;if(n(e)!="number"||e<1||e<this.version())throw new TypeError("not valid version");this._current={version:e,store:null};this._versions[e]={stores:[],dropStores:[],indexes:[],dropIndexes:[],version:e};return this};u.prototype.addStore=function(e,t){if(n(e)!="string")throw new TypeError("`name` is required");if(this._stores[e])throw new TypeError("store is already defined");if(!t)t={};var r={name:e,indexes:{},keyPath:t.key||t.keyPath||null,autoIncrement:t.increment||t.autoIncrement||false};this._stores[e]=r;this._versions[this.version()].stores.push(r);this._current.store=r;return this};u.prototype.delStore=function(e){if(n(e)!="string")throw new TypeError("`name` is required");var t=this._stores[e];if(!t)throw new TypeError("store is not defined");delete this._stores[e];this._versions[this.version()].dropStores.push(t);this._current.store=null;return this};u.prototype.getStore=function(e){if(n(e)!="string")throw new TypeError("`name` is required");if(!this._stores[e])throw new TypeError("store is not defined");this._current.store=this._stores[e];return this};u.prototype.addIndex=function(e,t,r){if(n(e)!="string")throw new TypeError("`name` is required");if(n(t)!="string"&&n(t)!="array")throw new TypeError("`field` is required");if(!r)r={};var o=this._current.store;if(o.indexes[e])throw new TypeError("index is already defined");var i={name:e,field:t,storeName:o.name,multiEntry:r.multi||r.multiEntry||false,unique:r.unique||false};o.indexes[e]=i;this._versions[this.version()].indexes.push(i);return this};u.prototype.delIndex=function(e){if(n(e)!="string")throw new TypeError("`name` is required");var t=this._current.store.indexes[e];if(!t)throw new TypeError("index is not defined");delete this._current.store.indexes[e];this._versions[this.version()].dropIndexes.push(t);return this};u.prototype.callback=function(){var e=i(o(this._versions)).sort(function(e,t){return e.version-t.version});return function t(r){var n=r.oldVersion>s?0:r.oldVersion;var o=r.target.result;var i=r.target.transaction;e.forEach(function(e){if(n>=e.version)return;e.stores.forEach(function(e){o.createObjectStore(e.name,{keyPath:e.keyPath,autoIncrement:e.autoIncrement})});e.dropStores.forEach(function(e){o.deleteObjectStore(e.name)});e.indexes.forEach(function(e){var t=i.objectStore(e.storeName);t.createIndex(e.name,e.field,{unique:e.unique,multiEntry:e.multiEntry})});e.dropIndexes.forEach(function(e){var t=i.objectStore(e.storeName);t.deleteIndex(e.name)})})}};u.prototype.stores=function(){return i(o(this._stores)).map(function(e){e.indexes=i(e.indexes).map(function(e){delete e.storeName;return e});return e})};u.prototype.clone=function(){var e=new u;var t=this;Object.keys(this).forEach(function(r){e[r]=o(t[r])});return e}},{"component-clone":11,"component-type":7,"object-values":12}],11:[function(e,t,r){var n;try{n=e("component-type")}catch(o){n=e("type")}t.exports=i;function i(e){switch(n(e)){case"object":var t={};for(var r in e){if(e.hasOwnProperty(r)){t[r]=i(e[r])}}return t;case"array":var t=new Array(e.length);for(var o=0,s=e.length;o<s;o++){t[o]=i(e[o])}return t;case"regexp":var u="";u+=e.multiline?"m":"";u+=e.global?"g":"";u+=e.ignoreCase?"i":"";return new RegExp(e.source,u);case"date":return new Date(e.getTime());default:return e}}},{"component-type":7,type:7}],12:[function(e,t,r){"use strict";t.exports=function(e){var t=Object.keys(e);var r=[];for(var n=0;n<t.length;n++){r.push(e[t[n]])}return r}},{}]},{},[5])(5)});
